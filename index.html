<!DOCTYPE html>
<html>
<head>
  <title>Accelerometer Graph</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; }
    canvas { max-width: 90%; margin: 20px auto; }
  </style>
</head>
<body>
  <h1>Accelerometer Graph (X, Y, Z)</h1>
  <canvas id="accelChart"></canvas>

  <script>
    // --- Setup Chart.js ---
    const ctx = document.getElementById('accelChart').getContext('2d');
    const data = {
      labels: Array(50).fill(''), // last 50 points
      datasets: [
        { label: 'X', data: Array(50).fill(0), borderColor: 'red', tension: 0.3 },
        { label: 'Y', data: Array(50).fill(0), borderColor: 'green', tension: 0.3 },
        { label: 'Z', data: Array(50).fill(0), borderColor: 'blue', tension: 0.3 },
      ]
    };
    const config = {
      type: 'line',
      data: data,
      options: {
        animation: false,
        scales: { y: { min: -20, max: 20 } } // adjust according to your sensor
      }
    };
    const accelChart = new Chart(ctx, config);

    // --- Low-pass filter setup ---
    let lastX = 0, lastY = 0, lastZ = 0;
    const alpha = 0.1; // smoothing factor

    function updateChart(x, y, z) {
      data.datasets[0].data.push(x); data.datasets[0].data.shift();
      data.datasets[1].data.push(y); data.datasets[1].data.shift();
      data.datasets[2].data.push(z); data.datasets[2].data.shift();
      accelChart.update();
    }

    function handleMotion(event) {
      let x = event.acceleration.x || 0;
      let y = event.acceleration.y || 0;
      let z = event.acceleration.z || 0;

      // Low-pass smoothing
      lastX = lastX + alpha * (x - lastX);
      lastY = lastY + alpha * (y - lastY);
      lastZ = lastZ + alpha * (z - lastZ);

      updateChart(lastX, lastY, lastZ);
    }

    function requestMotionPermission() {
      if (typeof DeviceMotionEvent !== 'undefined' &&
          typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('devicemotion', handleMotion);
            } else {
              alert('Permission denied for accelerometer');
            }
          })
          .catch(console.error);
      } else {
        window.addEventListener('devicemotion', handleMotion);
      }
    }

    requestMotionPermission();
  </script>
</body>
</html>
