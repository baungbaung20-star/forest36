<!DOCTYPE html>
<html>
<head>
  <title>Accelerometer Ball</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    canvas { display: block; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = window.innerWidth;
    let H = canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
      W = canvas.width = window.innerWidth;
      H = canvas.height = window.innerHeight;
    });

    // Ball setup
    const ball = {
      x: W/2,
      y: H/2,
      radius: 30,
      vx: 0,
      vy: 0,
      color: 'cyan',
      damping: 0.8
    };

    // Accelerometer smoothing
    let ax = 0, ay = 0;
    const alpha = 0.1;

    function handleMotion(event) {
      let rawX = event.acceleration.x || 0;
      let rawY = event.acceleration.y || 0;

      // Smooth
      ax = ax + alpha * rawX;
      ay = ay + alpha * rawY;
    }

    function update() {
      // Invert axes to match screen
      ball.vx += ax; 
      ball.vy += ay;

      ball.x += ball.vx;
      ball.y += ball.vy;

      // Bounce on edges
      if(ball.x + ball.radius > W) { ball.x = W - ball.radius; ball.vx *= -ball.damping; }
      if(ball.x - ball.radius < 0) { ball.x = ball.radius; ball.vx *= -ball.damping; }
      if(ball.y + ball.radius > H) { ball.y = H - ball.radius; ball.vy *= -ball.damping; }
      if(ball.y - ball.radius < 0) { ball.y = ball.radius; ball.vy *= -ball.damping; }
    }

    function draw() {
      ctx.clearRect(0,0,W,H);

      // Draw ball
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
      ctx.fillStyle = ball.color;
      ctx.fill();
      ctx.closePath();
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    function requestMotionPermission() {
      if (typeof DeviceMotionEvent !== 'undefined' &&
          typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('devicemotion', handleMotion);
            } else {
              alert('Permission denied for accelerometer');
            }
          })
          .catch(console.error);
      } else {
        window.addEventListener('devicemotion', handleMotion);
      }
    }

    requestMotionPermission();
    loop();
  </script>
</body>
</html>
