<!DOCTYPE html>
<html>
<head>
  <title>Smooth Horizontal Shake Ball</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    canvas { display: block; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  ball.y = H/2; // center Y
});

// Ball setup
const ball = {
  x: W/2,
  y: H/2,
  radius: 30,
  vx: 0,
  color: 'cyan',
  damping: 0.8
};

// Accelerometer smoothing
let ax = 0;
const alpha = 0.1;
const threshold = 0.2; // lower threshold

function handleMotion(event) {
  let rawX = event.acceleration.x || 0;

  // Smooth
  ax = ax + alpha * rawX;

  // Apply threshold
  if(Math.abs(ax) < threshold) ax = 0;
}

function update() {
  // Add small random jitter if ax is zero
  let jitter = (ax === 0) ? (Math.random() - 0.5) * 0.2 : 0;

  ball.vx += ax + jitter;
  ball.x += ball.vx;

  // Bounce on edges
  if(ball.x + ball.radius > W) { ball.x = W - ball.radius; ball.vx *= -ball.damping; }
  if(ball.x - ball.radius < 0) { ball.x = ball.radius; ball.vx *= -ball.damping; }

  // Slight friction
  ball.vx *= 0.995;
}

function draw() {
  ctx.clearRect(0,0,W,H);

  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
  ctx.fillStyle = ball.color;
  ctx.fill();
  ctx.closePath();
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

function requestMotionPermission() {
  if (typeof DeviceMotionEvent !== 'undefined' &&
      typeof DeviceMotionEvent.requestPermission === 'function') {
    DeviceMotionEvent.requestPermission()
      .then(permissionState => {
        if (permissionState === 'granted') {
          window.addEventListener('devicemotion', handleMotion);
        } else {
          alert('Permission denied for accelerometer');
        }
      })
      .catch(console.error);
  } else {
    window.addEventListener('devicemotion', handleMotion);
  }
}

requestMotionPermission();
loop();
</script>
</body>
</html>
